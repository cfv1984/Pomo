!function(ctx){var noop=function(){},instance;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var sprintf=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var r=[];t>0;r[--t]=e);return r.join("")}var r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.format=function(r,n){var s,i,a,o,l,c,u,d=1,f=r.length,p="",g=[];for(i=0;f>i;i++)if(p=e(r[i]),"string"===p)g.push(r[i]);else if("array"===p){if(o=r[i],o[2])for(s=n[d],a=0;a<o[2].length;a++){if(!s.hasOwnProperty(o[2][a]))throw sprintf('[sprintf] property "%s" does not exist',o[2][a]);s=s[o[2][a]]}else s=o[1]?n[o[1]]:n[d++];if(/[^s]/.test(o[8])&&"number"!=e(s))throw sprintf("[sprintf] expecting number but found %s",e(s));switch(o[8]){case"b":s=s.toString(2);break;case"c":s=String.fromCharCode(s);break;case"d":s>>=0;break;case"e":s=o[7]?s.toExponential(o[7]):s.toExponential();break;case"f":s=o[7]?parseFloat(s).toFixed(o[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s=String(s))&&o[7]?s.substring(0,o[7]):s;break;case"u":s=Math.abs(s);break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}s=/[def]/.test(o[8])&&o[3]&&s>=0?"+"+s:s,c=o[4]?"0"===o[4]?"0":o[4].charAt(1):" ",u=o[6]-String(s).length,l=o[6]?t(c,u):"",g.push(o[5]?s+l:l+s)}return g.join("")},r.cache={},r.parse=function(e){for(var t=e,r=[],n=[],s=0;t;){if(null!==(r=/^[^\x25]+/.exec(t)))n.push(r[0]);else if(null!==(r=/^\x25{2}/.exec(t)))n.push("%");else{if(null===(r=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(r[2]){s|=1;var i=[],a=r[2],o=[];if(null===(o=/^([a-z_][a-z_\d]*)/i.exec(a)))throw"[sprintf] huh?";for(i.push(o[1]);""!==(a=a.substring(o[0].length));)if(null!==(o=/^\.([a-z_][a-z_\d]*)/i.exec(a)))i.push(o[1]);else{if(null===(o=/^\[(\d+)\]/.exec(a)))throw"[sprintf] huh?";i.push(o[1])}r[2]=i}else s|=2;if(3===s)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";n.push(r)}t=t.substring(r[0].length)}return n},r}(),vsprintf=function(e,t){return t.unshift(e),sprintf.apply(null,t)},isBrowser=function(){return"undefined"!=typeof window&&!!document&&!!document.getElementsByTagName},escapeString=function(e){var t;return e.constructor!=String()&&(t=e),e.replace&&(t=e.replace(/[\"]/g,'\\"').replace(/[\\]/g,"\\").replace(/[\/]/g,"/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t")),t},unescapeString=function(e){var t;return e&&e.replace&&(t=e.replace("\\n","\n").replace("\\r","\r").replace("\\t","	").replace("\\f","\f").replace("\\b","\b").replace("\\r","\r")),t},waitUntilReady=function(e){var t=setInterval(function(){instance&&!instance.waiting&&(clearInterval(t),e.call(e))},4)},extend=function(e,t){var r,n=this,s=Object.prototype.hasOwnProperty;if(r=e&&s.call(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},t)for(var i in t)r[i]=t[i];var a=function(){this.constructor=r};if(a.prototype=n.prototype,r.prototype=new a,e)for(var o in e)r.prototype[o]=e[o];return r.extend=extend,r.__super__=n.prototype,r};entryExists=function(e,t,r){return!!(e&&e.contents&&e.contents[t]&&e.contents[t][r])};var Errors={};Errors.Base=extend.call(Error,{toString:function(){return this.name+": "+this.message}}),Errors.CustomError=Errors.Base.extend({constructor:function(e){this.name="CustomError",this.message=e,this.stack=(new Error).stack}}),Errors.CustomError.extend=extend,Errors.UnknownEntryError=Errors.CustomError.extend({constructor:function(e,t){var r;e=e?e:"malformed",t=t?t:"default_domain",r="Message ID '"+e+"' not found in domain '"+t+"'",Errors.CustomError.call(this,r),this.name="UnknownEntryError"}}),Errors.UnknownAcquisitionModeError=Errors.CustomError.extend({constructor:function(e){var t;e=e?e:"None provided",t='PO files acquisition mode: "'+e+'" is not valid.',Errors.CustomError.call(this,t),this.name="UnknownAcquisitionModeError"}});var Parser={};Parser.Object=function(e){var t=1;for(var r in e)this[r]=e[r];this.setCount=function(e){t=e>>0},this.toString=function(){var e,r;if(r=!this.isPlural&&this.plural_forms&&this.plural_forms.push&&!!instance.storage.calculatePluralIndex){var n=instance.storage.calculatePluralIndex(t);e=this.plural_forms[n]}else e=this.translation;return e}},Parser.POFiles={parse:function(text,translation_domain){text=text?text:"";var getTelltale,extractHeaderInfo,isMultilinePlural,multilineExtract;getTelltale=function(e){return e.substring(0,12).split(" ")[0].trim()},isMultilinePlural=function(e){return!!e&&e.match(/msgstr\[[0-9]\]/)},extractHeaderInfo=function(header){for(var header_lines=header.split("\n"),i=0,j=header_lines.length;j>i;i++){var header_line=header_lines[i];if(0===header_line.indexOf('"Plural-Forms: nplurals')){var plural_form=header_line.substring(14).slice(0,-1);instance.storage.calculatePluralIndex=function(phrase_count){return eval(unescapeString(plural_form)),"undefined"==typeof plural&&(plural=0),plural}}}},multilineExtract=function(e){for(var t,r=[];t=e.shift();){if(t=t.trim(),0!==t.indexOf('"')){e.unshift(t);break}r.push(t.substring(1).slice(0,-1))}return r.join("")};var parsed={},has_header_info,header_info,part,domain="undefined"==typeof translation_domain?"messages":translation_domain,counter=0,text=text.replace(/\r\n|\r/g,"\n"),parts;for(parsed[domain]={},parts=text.split(/\n\n/),header_info=parts.shift(),has_header_info=extractHeaderInfo(header_info),has_header_info?instance.storage.header_info=extractHeaderInfo(has_header_info):parts.unshift(header_info);part=parts.shift();){for(var message={},part_lines=part?part.split(/\n/):[],line="",escaped;line=part_lines.shift();){line=line.trim();var next_line=part_lines.slice(0,-1)[0],line_telltale=getTelltale(line),next_line_telltale=next_line?getTelltale(next_line):!1;switch(line_telltale){case"msgctxt":message.context=line.substring(9).slice(0,-1);break;case"msgid_plural":message.isPlural=!0,message.plural_id=line.substring(14).slice(0,-1);break;case"msgid":if(0===line.indexOf('msgid ""')){var possible=next_line.trim();0===possible.indexOf('"')&&(message.id=multilineExtract(part_lines))}else(next_line_telltale="msgstr")&&(message.id=line.substr(7).slice(0,-1));continue;case"msgstr":0===line.indexOf('msgstr ""')?(possible=next_line.trim(),0===possible.indexOf('"')&&(message.translation=multilineExtract(part_lines))):message.translation=line.substr(8).slice(0,-1);break;case"#:":case"#.":case"#":continue;case"#,":break;default:if(isMultilinePlural(line)){for(var cases=[];isMultilinePlural(line);)cases.push(line.substring(10).slice(0,-1)),line=part_lines.shift();message.plural_forms=cases,message.translation=cases[0]}continue}}message.id&&message.translation&&(message=new Parser.Object(message),escaped=escapeString(message.id),parsed[domain][message.id]?parsed[domain][escaped].push(message):parsed[domain][escaped]=[message]),counter++}return parsed},generate:function(){throw"Feature unimplemented"}};var Providers={};Providers.Base=function(e){var t,r=this;r.domain=e,r.waiting=!0,r.done=function(e){t=e;var n=setInterval(function(){r.waiting||(clearInterval(n),t.call(t,r.parsed))},4)}},Providers.Base.prototype={toString:function(){return"[object Adapter]"},getContents:noop},Providers.Base.extend=extend,Providers.String=Providers.Base.extend({constructor:function(e,t){Providers.Base.call(this,t),this.parsed=null,this.unparsed=""+e},getContents:function(){var e=this;e.waiting=!0,e.parsed=Parser.POFiles.parse(this.unparsed,this.domain),e.waiting=!1}}),isBrowser()||(Providers.File=Providers.Base.extend({constructor:function(e,t){Providers.Base.call(this,t),this.path=""+e},getContents:function(){var e=this;instance.waiting=!0,e.waiting=!0,require("fs").readFile(this.path,"utf-8",function(t,r){if(t)throw new Errors.FileReaderError(t.path);e.parsed=Parser.POFiles.parse(r,e.domain),e.waiting=!1})}})),isBrowser()&&(Providers.Ajax=Providers.Base.extend({constructor:function(e,t){Providers.Base.call(this,t),this.url=e},doRequest:function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),t=t?t:noop,r=r?r:noop;try{n.onreadystatechange=function(){var e={error:!0};4===this.readyState&&(this.status>=200&&this.status<400?(e=this.responseText,t.call(t,e)):r.call(r,e))},n.send()}catch(s){r.call(r,{error:!0})}n=null},getContents:function(){var e=this.domain,t=this;instance.waiting=!0,this.doRequest(this.url,function(r){var n=new Providers.String(r,e);n.done(function(e){t.parsed=e,t.waiting=!1}),n.getContents()})}})),isBrowser()&&(Providers.Links=Providers.Ajax.extend({construct:function(){},getContents:function(){instance.waiting=!0;for(var e,t=document.getElementsByTagName("link"),r=(Providers.Ajax,this),n=0,s=t.length;s>n;n++)e=t[n],e&&e.getAttribute("type")&&e.getAttribute("href")&&"text/x-gettext-translation"===e.getAttribute("type")&&(instance.waiting=!0,this.doRequest(e.href,function(e){var t=new Providers.String(e,r.domain);t.done(function(e){r.parsed=e,r.waiting=!1}),t.getContents()}))}}));var Pomo=function(){var e,t=this;t.storage={},t.waiting=!0,t.VERSION="0.1.3",t.domain="messages",t.returnStrings=!1,t.unescapeStrings=!1,t.ready=function(r){e=r;var n=setInterval(function(){t.waiting||(clearInterval(n),e.call(e))},2)},t.wipe=function(){t.storage={},t.waiting=!0},t.load=function(e,r){r=r?r:{},t.waiting=!0;var n,s=r.mode?r.mode:!1,i=r.translation_domain?r.translation_domain:"messages";switch(s){case"literal":n=new Providers.String(e,i);break;case"file":n=new Providers.File(e,i);break;case"link":n=new Providers.Links(i);break;case"ajax":n=new Providers.Ajax(e,i);break;default:throw new Errors.UnknownAcquisitionModeError(s)}return n.done(function(e){t.storage.contents=e,t.waiting=!1}),n.getContents(),this},t.getText=function(e,r){e=e.split(/\n/).join(""),r=r?r:{};var n=r.variables?r.variables:[],s=r.context?r.context:!1,i=r.domain?r.domain:"messages",a=r.count?r.count:!1,o=r.error?r.error:noop,l=escapeString(e);if(i||t.domain?t.domain=i&&!t.domain?i:i:i=t.domain="messages",entryExists(t.storage,i,l)){var c=t.storage.contents[i][l];if(s)for(var u=0,d=c.length;d>u;u++)if(c.context&&c.context===s){f=c[u];break}c.unshift&&(c=c[0]),a&&c.setCount(a);var f=c,p=c.constructor===String();if(t.returnStrings&&(f=c.toString()),n){var g=p?f:f.translation,h=vsprintf(g,n);p?f=h:f.translation=h}return p&&t.unescapeStrings?f=unescapeString(f):t.unescapeStrings&&!p&&(f.translation=unescapeString(f.translation)),f}if(o===noop)throw new Errors.UnknownEntryError(e,i);o(o,e,i,t.storage.contents)}};instance=new Pomo,"undefined"!=typeof module?module.exports=instance:window.Pomo=instance}(this);