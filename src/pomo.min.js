!function(ctx){function microAjax(e,t){if(this.bindFunction=function(e,t){return function(){return e.apply(t,[t])}},this.stateChange=function(){4===this.request.readyState&&this.callbackFunction(this.request.responseText)},this.getRequest=function(){return window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?new XMLHttpRequest:!1},this.postBody=arguments[2]||"",this.callbackFunction=t,this.url=e,this.request=this.getRequest(),this.request){var r=this.request;r.onreadystatechange=this.bindFunction(this.stateChange,this),""!==this.postBody?(r.open("POST",e,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.setRequestHeader("Connection","close")):r.open("GET",e,!0),r.send(this.postBody)}}var sprintf=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var r=[];t>0;r[--t]=e);return r.join("")}var r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.format=function(r,n){var s,a,i,o,l,p,u,c=1,d=r.length,f="",m=[];for(a=0;d>a;a++)if(f=e(r[a]),"string"===f)m.push(r[a]);else if("array"===f){if(o=r[a],o[2])for(s=n[c],i=0;i<o[2].length;i++){if(!s.hasOwnProperty(o[2][i]))throw sprintf('[sprintf] property "%s" does not exist',o[2][i]);s=s[o[2][i]]}else s=o[1]?n[o[1]]:n[c++];if(/[^s]/.test(o[8])&&"number"!=e(s))throw sprintf("[sprintf] expecting number but found %s",e(s));switch(o[8]){case"b":s=s.toString(2);break;case"c":s=String.fromCharCode(s);break;case"d":s>>=0;break;case"e":s=o[7]?s.toExponential(o[7]):s.toExponential();break;case"f":s=o[7]?parseFloat(s).toFixed(o[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s+="")&&o[7]?s.substring(0,o[7]):s;break;case"u":s=Math.abs(s);break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}s=/[def]/.test(o[8])&&o[3]&&s>=0?"+"+s:s,p=o[4]?"0"===o[4]?"0":o[4].charAt(1):" ",u=o[6]-(s+"").length,l=o[6]?t(p,u):"",m.push(o[5]?s+l:l+s)}return m.join("")},r.cache={},r.parse=function(e){for(var t=e,r=[],n=[],s=0;t;){if(null!==(r=/^[^\x25]+/.exec(t)))n.push(r[0]);else if(null!==(r=/^\x25{2}/.exec(t)))n.push("%");else{if(null===(r=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(r[2]){s|=1;var a=[],i=r[2],o=[];if(null===(o=/^([a-z_][a-z_\d]*)/i.exec(i)))throw"[sprintf] huh?";for(a.push(o[1]);""!==(i=i.substring(o[0].length));)if(null!==(o=/^\.([a-z_][a-z_\d]*)/i.exec(i)))a.push(o[1]);else{if(null===(o=/^\[(\d+)\]/.exec(i)))throw"[sprintf] huh?";a.push(o[1])}r[2]=a}else s|=2;if(3===s)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";n.push(r)}t=t.substring(r[0].length)}return n},r}(),vsprintf=function(e,t){return t.unshift(e),sprintf.apply(null,t)},CustomError=function(e){this.name="CustomError",this.message=e,this.stack=Error().stack},UnknownMsgIdError=function(e,t){t||(t="default_domain");var r="Message ID '"+e+"' not found in domain '"+t+"'";CustomError.call(this,r),this.name="UnknownMsgIdError"};UnknownMsgIdError.prototype=CustomError.prototype,UnknownMsgIdError.prototype.constructor=CustomError;var UnknownAcquisitionModeError=function(e){e||(e="None provided");var t='PO files acquisition mode: "'+e+'" is not valid.';CustomError.call(this,t),this.name="UnknownAcquisitionModeError"};UnknownMsgIdError.prototype=CustomError.prototype,UnknownMsgIdError.prototype.constructor=CustomError;var FileReaderError=function(e){var t="Adapter cannot read from file: "+e;CustomError.call(this,t),this.name="FileReaderError"};FileReaderError.prototype=CustomError.prototype,FileReaderError.prototype.constructor=CustomError;var Pomo=function(){this.VERSION="0.1.1",this.domain="messages",this.returnStrings=!1,this.unescapeStrings=!1;var adapters={},getWaiter=function(){var e={ready:function(t){me.waiting?setTimeout(function(){e.ready(t)},20):t.apply(me,[])}};return e},Adapters={};Adapters.Base=function(e){this.toString=function(){return"[object Adapter]"},this.domain=e},Adapters.Base.prototype={loadContents:null},Adapters.StringAdapter=function(e,t){Adapters.Base.call(this,t),this.parsed=null,this.unparsed=e},Adapters.StringAdapter.prototype={loadContents:function(){me.waiting=!0,null===this.parsed&&(this.parsed=me.Parser.po.parse(this.unparsed,this.domain)),me.storage.contents=this.parsed,me.waiting=!1}},Adapters.StringAdapter.constructor=Adapters.Base,"undefined"==typeof window&&(Adapters.FileAdapter=function(e,t){Adapters.Base.call(this,t),this.path=e},Adapters.FileAdapter.prototype={loadContents:function(){me.waiting=!0;var e=require("fs");e.readFile(this.path,"utf-8",function(e,t){if(e)throw new FileReaderError(e.path);me.storage.contents=me.Parser.po.parse(t,this.domain),me.waiting=!1})}}),"undefined"!=typeof window&&document&&document.getElementsByTagName&&(Adapters.LinkAdapter=function(e){Adapters.Base.call(this,e)},Adapters.LinkAdapter.prototype={loadContents:function(){me.waiting=!0;for(var e,t=document.getElementsByTagName("link"),r=Adapters.AjaxAdapter,n=0,s=t.length;s>n;n++)if(e=t[n],e&&e.getAttribute("type")&&e.getAttribute("href")&&"text/x-gettext-translation"===e.getAttribute("type")){var a=new r(e.getAttribute("href"),this.domain);a.loadContents()}}},Adapters.AjaxAdapter=function(e,t){Adapters.Base.call(this,t),this.url=e},Adapters.AjaxAdapter.prototype={loadContents:function(){var e=this.domain;me.waiting=!0,microAjax(this.url,function(t){var r=new Adapters.StringAdapter(t,e);r.loadContents()})}});var escapeString=function(e){var t;return""!=e.constructor&&(t=e),e.replace&&(t=e.replace(/[\"]/g,'\\"').replace(/[\\]/g,"\\").replace(/[\/]/g,"/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t")),t},unescapeString=function(e){var t;return e&&e.replace&&(t=e.replace("\\n","\n").replace("\\r","\r").replace("\\t","	").replace("\\f","\f").replace("\\b","\b").replace("\\r","\r")),t};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var me=this;me.storage={},me.Parser={},me.Parser.Object=function(e){var t=1;for(var r in e)this[r]=e[r];this.setCount=function(e){t=e>>0},this.toString=function(){var e;if(!this.isPlural&&this.plural_forms&&this.plural_forms.push&&me.storage.calculatePluralIndex){var r=me.storage.calculatePluralIndex(t);e=this.plural_forms[r]}else e=this.translation;return e}},me.Parser.po={parse:function(text,translation_domain){var getTelltale=function(e){return e.substring(0,12).split(" ")[0].trim()},extract_header_info=function(header){for(var header_lines=header.split("\n"),i=0,j=header_lines.length;j>i;i++)if(0===header_lines[i].indexOf('"Plural-Forms: nplurals')){var plural_form=header_lines[i].substring(14).slice(0,-1);me.storage.calculatePluralIndex=function(n){return eval(unescapeString(plural_form)),"undefined"==typeof plural&&(plural=0),plural}}},parsed={},has_header_info,header_info,part,domain=void 0===translation_domain?"messages":translation_domain,parts=[],counter=0,text=text.replace(/\r\n|\r/g,"\n");for(parsed[domain]={},parts=text.split(/\n\n/),header_info=parts.shift(),has_header_info=extract_header_info(header_info),has_header_info?me.storage.header_info=extract_header_info(has_header_info):parts.unshift(header_info);part=parts.shift();){for(var message={},part_lines=part?part.split(/\n/):[],line="";line=part_lines.shift();){line=line.trim();var next_line=part_lines.slice(0,-1)[0],line_telltale=getTelltale(line),next_line_telltale=next_line?getTelltale(next_line):!1;switch(line_telltale){case"msgctxt":message.context=line.substring(9).slice(0,-1);break;case"msgid_plural":message.isPlural=!0,message.plural_id=line.substring(14).slice(0,-1);break;case"msgid":if(0===line.indexOf('msgid ""')){var possible=next_line.trim();if(0===possible.indexOf('"')){for(var msgid_buf=[];possible=part_lines.shift();){if(possible=possible.trim(),0!==possible.indexOf('"')){part_lines.unshift(possible);break}msgid_buf.push(possible.substring(1).slice(0,-1))}message.id=msgid_buf.join("")}}else(next_line_telltale="msgstr")&&(message.id=line.substr(7).slice(0,-1));continue;case"msgstr":if(0===line.indexOf('msgstr ""')){for(var msgstr_buf=[];possible=part_lines.shift();){if(possible=possible.trim(),0!==possible.indexOf('"')){part_lines.unshift(possible);break}msgstr_buf.push(possible.substr(1).slice(0,-1))}message.translation=msgstr_buf.join("")}else message.translation=line.substr(8).slice(0,-1);break;case"#:":case"#.":case"#":continue;case"#,":break;default:if(line&&line.match(/msgstr\[[0-9]\]/)){for(var cases=[];line&&line.match(/msgstr\[[0-9]\]/);)cases.push(line.substring(10).slice(0,-1)),line=part_lines.shift();message.plural_forms=cases,message.translation=cases[0]}continue}}message.id&&message.translation&&(message=new me.Parser.Object(message),parsed[domain][message.id]?parsed[domain][escapeString(message.id)].push(message):parsed[domain][escapeString(message.id)]=[message]),counter++}return parsed},generate:function(){throw"Feature unimplemented"}},this.wipe=function(){me.storage.contents={}},this.load=function(e,t){t=t?t:{};var r,n,s=(t.format?t.format:!1,t.mode?t.mode:!1);switch(n=t.translation_domain?t.translation_domain:"messages",s){case"literal":r=new Adapters.StringAdapter(e,n);break;case"file":r=new Adapters.FileAdapter(e,n);break;case"link":r=new Adapters.LinkAdapter(n);break;case"ajax":r=new Adapters.AjaxAdapter(e,n);break;default:throw new UnknownAcquisitionModeError(s)}return r.loadContents(),getWaiter()},this.getText=function(e,t){t=t?t:{},e=e.split(/\n/).join("");var r=t.variables?t.variables:[],n=t.context?t.context:!1,s=t.domain?t.domain:"messages",a=t.count?t.count:!1,i=escapeString(e);if(s||me.domain?me.domain=s&&!me.domain?s:s:s=me.domain="messages",me.storage.contents[s]&&me.storage.contents[s][i]){var o=me.storage.contents[s][i];if(n)for(var l=0,p=me.storage.contents[s][i].length;p>l;l++)if(o.context&&o.context===n){u=me.storage.contents[s][i][l];break}me.storage.contents[s][i].unshift&&(o=me.storage.contents[s][i][0]),a&&o.setCount(a);var u=o,c=""===o.constructor;if(me.returnStrings&&(u=""+o),r){var d=c?u:u.translation,f=vsprintf(d,r);c?u=f:u.translation=f}return c&&me.unescapeStrings?u=unescapeString(u):me.unescapeStrings&&!c&&(u.translation=unescapeString(u.translation)),u}throw new UnknownMsgIdError(e,s)},this.getMap=function(){return me.storage.contents},this.use=function(e,t){t.loadContents&&t.loadContents.constructor===Function&&(adapters[e]=t)},function(e){e.use("literal",new Adapters.StringAdapter),"undefined"==typeof window&&e.use("file",new Adapters.FileAdapter),"undefined"!=typeof window&&document&&document.getElementsByTagName&&e.use("link",new Adapters.LinkAdapter),"undefined"!=typeof window&&(window.XMLHTTPRequest||window.ActiveXObject)&&e.use("ajax",new Adapters.AjaxAdapter)}(this)},pomo=new Pomo;"undefined"!=typeof module?module.exports=pomo:window.Pomo=pomo}(this);